"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,l=new Array(e.length);t<e.length;t++)l[t]=e[t];return l}}jQuery(function(o){var e=Object.assign(document.createElement("style"),{id:"label-style"});document.head.appendChild(e);var r=document.querySelector(".product-label"),n=document.querySelector(".label-wrap"),c=document.querySelector("#_wapl_label_type"),u=document.querySelector("#_wapl_label_text"),s=document.querySelector("#_wapl_label_style"),i=document.querySelector("#_wapl_label_align"),d=document.querySelector("#wapl-custom-position-left"),p=document.querySelector("#wapl-custom-position-top"),m=document.querySelector(".wapl-meta-box, #woocommerce_advanced_product_labels");if(r){c.addEventListener("change",a),a(),s.addEventListener("input",y),y(),u.addEventListener("input",w),i.addEventListener("change",b),b(),g(),d.addEventListener("change",v),p.addEventListener("change",v),document.body.addEventListener("keydown",function(e){if("custom"===i.value){var t=document.activeElement,l=e.shiftKey?10:1,a=r.style.left||r.offsetLeft,o=r.style.top||r.offsetTop;if(t&&-1!==["input","select","button","textarea","div"].indexOf(t.tagName.toLowerCase()))return!0;switch(e.keyCode||e.which){case 37:f(parseInt(a,10)-l);break;case 38:f(null,parseInt(o,10)-l);break;case 39:f(parseInt(a,10)+l);break;case 40:f(null,parseInt(o,10)+l);break;default:return!0}e.preventDefault()}}),o("#wapl-custom-background").wpColorPicker({color:"#D9534F",palettes:!1,change:function(e,t){r.style.backgroundColor=t.color.toString(),document.querySelector("#label-style").innerHTML=".label-wrap .product-label:after { border-color: "+t.color.toString()+"; }"}}),o("#wapl-custom-text").wpColorPicker({color:"#fff",palettes:!1,change:function(e,t){r.style.color=t.color.toString()}});var t,l=wp.media.model.settings.post.id;o("#upload_image_button").on("click",function(e){if(e.preventDefault(),t)return t.uploader.uploader.param("post_id",0),void t.open();wp.media.model.settings.post.id=0,(t=wp.media.frames.file_frame=wp.media({title:"Select a image to upload",button:{text:"Use this image"},multiple:!1})).on("select",function(){var e=t.state().get("selection").first().toJSON();r.style.backgroundImage='url("'+e.url+'")',r.style.width=e.width+"px",r.style.height=e.height+"px",o("#custom-image-url").attr("value",e.url),o("#wapl-custom-image").val(e.id),_(),wp.media.model.settings.post.id=l}),t.open()}),o("a.add_media").on("click",function(){wp.media.model.settings.post.id=l}),o(document.body).on("click",".wapl-toggle-advanced",function(e){o(this).hasClass("woocommerce-input-toggle--enabled")?(o(this).removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled"),document.querySelector('[name="_wapl_label[enable_advanced]"]').checked=!1,o(this).parents(".wapl-global-option").removeClass("advanced-enabled"),document.querySelector("#wapl-custom-css").innerHTML=""):(o(this).removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"),document.querySelector('[name="_wapl_label[enable_advanced]"]').checked=!0,o(this).parents(".wapl-global-option").addClass("advanced-enabled"),window.wapl.codeEditor.codemirror.refresh(),document.querySelector("#wapl-custom-css").innerHTML=window.wapl.codeEditor.codemirror.getValue().trim())}),window.wapl.codeEditor=wp.codeEditor.initialize("_wapl_label_custom_css",wapl.codeEditorSettings),window.wapl.codeEditor.codemirror.on("change",function(e,t){document.querySelector("#wapl-custom-css").innerHTML=e.getValue().trim()})}function a(){var e,t,l=wapl.types.map(function(e){return"type-"+e}),a=c.value;(e=m.classList).remove.apply(e,_toConsumableArray(l)),m.classList.add("type-"+a),(t=n.classList).remove.apply(t,_toConsumableArray(wapl.types.map(function(e){return"wapl-"+e}))),n.classList.add("wapl-"+a),"custom"===a&&(u.value="",s.value="red",w(),y())}function y(e){var t,l,a;(t=r.classList).remove.apply(t,_toConsumableArray(wapl.colors.map(function(e){return"label-"+e}))),r.classList.add("label-"+s.value),(l=n.classList).remove.apply(l,_toConsumableArray(wapl.colors.map(function(e){return"label-"+e}))),n.classList.add("label-"+s.value),(a=m.classList).remove.apply(a,_toConsumableArray(wapl.colors.map(function(e){return"label-color-"+e}))),m.classList.add("label-color-"+s.value),"custom"!==s.value&&(r.style.backgroundColor="",r.style.color=""),"custom"===s.value&&"rgba(0, 0, 0, 0)"==function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}(r,"background-color")&&(r.style.backgroundColor=document.querySelector("#wapl-custom-background").value,r.style.color=document.querySelector("#wapl-custom-text").value,document.querySelector("#label-style").innerHTML=".label-wrap .product-label:after { border-color: "+o("#wapl-custom-background").val()+"; }")}function w(){document.querySelector(".wapl-label-text").innerHTML=u.value}function b(e){"custom"===i.value?(m.classList.add("align-custom"),r.style.top=p.value+"px",r.style.left=d.value+"px",_()):(m.classList.remove("align-custom"),r.style.top=null,r.style.left=null),n.classList.remove("wapl-alignnone","wapl-alignleft","wapl-alignright","wapl-aligncenter","wapl-aligncustom"),n.classList.add("wapl-align"+i.value)}function g(){var e=Math.round(r.style.left.replace("px","")),t=Math.round(r.style.top.replace("px",""));d.value=e,p.value=t}function v(){f(d.value,p.value)}function f(e,t){var l=0<arguments.length&&void 0!==e?e:null,a=1<arguments.length&&void 0!==t?t:null;null!==l&&(r.style.left=l+"px",d.value=l),null!==a&&(r.style.top=a+"px",p.value=a)}function _(){o(".product-label").draggable({create:g,stop:g,drag:g})}});